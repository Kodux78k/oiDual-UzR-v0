<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <title>DUAL // FUSION OS — Morph & Stagger</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="theme-color" content="#05070a">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@200;400;600;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/lucide@latest"></script>

  <style>
    :root{
      --bg-deep: #030406; 
      --glass-surface: rgba(18,18,22,0.8); 
      --glass-border: rgba(255,255,255,0.08);
      --neon-cyan: #00f2ff; 
      --neon-purple: #bd00ff; 
      --neon-orange: #ff9a3c;
      --font-ui: 'Montserrat', sans-serif; 
      --font-code: 'JetBrains Mono', monospace;
      
      /* Easings */
      --ease-out-back: cubic-bezier(0.34, 1.3, 0.64, 1); /* Efeito mola para abrir */
      --ease-smooth: cubic-bezier(0.23, 1, 0.32, 1);     /* Padrão suave */
    }
    
    *{box-sizing:border-box;-webkit-tap-highlight-color:transparent;outline:none;user-select:none}
    
    body{
      margin:0;padding:0;min-height:100vh;background-color:var(--bg-deep);color:#fff;
      font-family:var(--font-ui);display:flex;align-items:center;justify-content:center;overflow:hidden;
      background-image:
        radial-gradient(circle at 50% 50%, rgba(255,255,255,0.03) 1px, transparent 1px);
      background-size:40px 40px;
    }

    /* Ambiente / Blobs */
    .ambient-light{position:fixed;inset:0;z-index:0;pointer-events:none}
    .blob{position:absolute;border-radius:50%;filter:blur(90px);opacity:0.12;animation:float 20s infinite alternate ease-in-out}
    .blob-1{width:60vw;height:60vw;background:var(--neon-cyan);top:-25%;left:-10%}
    .blob-2{width:50vw;height:50vw;background:var(--neon-purple);bottom:-25%;right:-10%;animation-delay:-5s}
    @keyframes float{0%{transform:translate(0,0)}100%{transform:translate(30px,50px)}}

    .container{width:100%;max-width:640px;padding:20px;z-index:10;perspective:1000px;display:flex;justify-content:center}

    /* CARD BASE */
    .fusion-card{
      width:100%; max-width:440px;
      background:var(--glass-surface);
      backdrop-filter:blur(24px);-webkit-backdrop-filter:blur(24px);
      border:1px solid var(--glass-border);
      border-radius:36px;
      padding:32px 28px;
      box-shadow:0 40px 100px rgba(0,0,0,0.6);
      position:relative; overflow:hidden;
      
      /* Propriedades animáveis via JS/CSS */
      will-change: width, padding, border-radius, box-shadow, transform;
      opacity:0; transform:translateY(30px);
    }
    
    .fusion-card.intro-done{opacity:1;transform:translateY(0);transition:opacity 0.6s, transform 0.6s var(--ease-smooth)}

    /* ESTADO FECHADO (Compacto) */
    .fusion-card.closed{
      width:260px; /* Largura compacta */
      padding:16px 20px;
      border-radius:24px;
      box-shadow:0 20px 60px rgba(0,0,0,0.5);
      cursor:pointer;
    }

    /* Ajustes internos no estado fechado */
    .fusion-card.closed .card-header{margin-bottom:0; gap:12px}
    .fusion-card.closed .brand-dual{font-size:1.2rem; margin-top:0}
    .fusion-card.closed .greeting-row{font-size:1rem}
    .fusion-card.closed .txt-thin{display:none} /* Oculta "Sistema" */
    .fusion-card.closed .avatar-slot{width:48px;height:48px;border-radius:10px}
    .fusion-card.closed .card-body{display:none} /* Esconde corpo */

    /* Prevenir transições CSS durante animação JS */
    .fusion-card.animating{transition: none !important;}

    /* Linha superior brilhante */
    .fusion-card::before{content:'';position:absolute;top:0;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.3),transparent)}

    /* HEADER */
    .card-header{display:flex;align-items:center;gap:16px;margin-bottom:24px;transition:margin 0.3s}
    .avatar-slot{width:64px;height:64px;flex-shrink:0;border-radius:14px;overflow:hidden;background:rgba(0,0,0,0.2);position:relative}
    
    .text-block{flex:1;display:flex;flex-direction:column;justify-content:center}
    .greeting-row{font-size:1.4rem;line-height:1;display:flex;align-items:baseline;gap:6px}
    .txt-thin{font-weight:300;color:rgba(255,255,255,0.6);font-size:0.9em}
    .txt-heavy{font-weight:700;color:#fff}

    .brand-dual{
      font-size:2rem;font-weight:800;line-height:1;letter-spacing:-1px;margin-top:6px;
      background:linear-gradient(135deg,#fff 20%,var(--neon-cyan),var(--neon-purple));
      -webkit-background-clip:text;-webkit-text-fill-color:transparent;
    }

    .clock-widget{text-align:right}
    .time-display{font-family:var(--font-code);font-size:0.9rem;color:rgba(255,255,255,0.4);font-weight:700}
    .status-led{width:6px;height:6px;background:var(--neon-cyan);border-radius:50%;display:inline-block;box-shadow:0 0 8px var(--neon-cyan);margin-top:4px}

    /* CARD BODY & STAGGER EFFECTS */
    .card-body{display:flex;flex-direction:column;gap:14px;position:relative}
    
    /* Classe para itens que vão entrar em cascata */
    .stagger-item {
      opacity: 0;
      transform: translateY(10px);
      transition: opacity 0.4s ease, transform 0.4s var(--ease-out-back);
    }
    
    /* Quando o conteúdo fica visível */
    .content-visible .stagger-item {
      opacity: 1;
      transform: translateY(0);
    }
    
    /* Delays de cascata */
    .content-visible .stagger-item:nth-child(1) { transition-delay: 0.05s; } /* Input */
    .content-visible .stagger-item:nth-child(2) { transition-delay: 0.1s; }  /* Botão */
    .content-visible .stagger-item:nth-child(3) { transition-delay: 0.15s; } /* Accordion */

    /* INPUT */
    .input-wrapper{position:relative}
    .cyber-input{
      width:100%;background:rgba(0,0,0,0.25);border:1px solid rgba(255,255,255,0.1);
      border-radius:16px;padding:16px 50px 16px 20px;
      color:#fff;font-family:var(--font-code);font-size:0.9rem;transition:0.3s;
    }
    .cyber-input:focus{
      border-color:var(--neon-cyan);background:rgba(0,0,0,0.4);
      box-shadow:0 0 20px rgba(0,242,255,0.1);
    }
    .input-icon{position:absolute;right:18px;top:50%;transform:translateY(-50%);color:rgba(255,255,255,0.3);width:20px}

    /* BUTTON */
    .trigger-btn{
      width:100%;padding:14px;border:1px dashed rgba(255,255,255,0.15);border-radius:12px;
      background:rgba(255,255,255,0.02);color:rgba(255,255,255,0.6);
      font-size:0.7rem;letter-spacing:1px;font-weight:600;text-transform:uppercase;
      cursor:pointer;display:flex;justify-content:center;align-items:center;gap:8px;
      transition:0.2s;
    }
    .trigger-btn:hover{background:rgba(255,255,255,0.05);color:#fff;border-color:var(--neon-purple)}

    /* MODULES (Accordion Interno) */
    .hidden-modules{
      display:grid;grid-template-rows:0fr;
      transition:grid-template-rows 0.5s var(--ease-smooth), opacity 0.5s;
      opacity:0.6;
    }
    .fusion-card.details-open .hidden-modules{grid-template-rows:1fr;opacity:1}
    
    .modules-inner{overflow:hidden;display:flex;flex-direction:column;gap:12px;padding-top:4px}

    /* Stats Grid */
    .stats-grid{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px}
    .stat-box{background:rgba(255,255,255,0.03);border-radius:12px;padding:12px 8px;text-align:center;border:1px solid transparent;transition:0.3s}
    .stat-box:hover{border-color:rgba(255,255,255,0.1);transform:translateY(-2px);background:rgba(255,255,255,0.06)}
    
    .stat-lbl{font-size:0.55rem;text-transform:uppercase;color:rgba(255,255,255,0.4);display:block;margin-bottom:4px}
    .stat-val{font-family:var(--font-code);font-size:0.9rem;font-weight:700;color:var(--neon-cyan)}

    /* Progress */
    .progress-container{background:rgba(0,0,0,0.2);padding:14px;border-radius:12px}
    .bar-track{height:4px;background:rgba(255,255,255,0.1);border-radius:2px;overflow:hidden;margin:8px 0}
    .bar-fill{height:100%;width:0%;background:linear-gradient(90deg,var(--neon-cyan),var(--neon-purple));box-shadow:0 0 12px var(--neon-cyan);transition:width 1s ease-out}
    .bar-meta{display:flex;justify-content:space-between;font-size:0.6rem;color:rgba(255,255,255,0.5);font-family:var(--font-code)}

    /* Footer Slot */
    .html-module-slot{
      border:1px solid var(--neon-orange);background:rgba(255,154,60,0.05);
      border-radius:12px;padding:12px;text-align:center;
      color:var(--neon-orange);font-size:0.7rem;font-family:var(--font-code);
    }
  </style>
</head>
<body>

  <div class="ambient-light">
    <div class="blob blob-1"></div>
    <div class="blob blob-2"></div>
  </div>

  <div class="container">
    <div class="fusion-card closed" id="mainCard" aria-expanded="false">
      
      <div class="card-header" id="cardHeader" role="button" tabindex="0">
        <div class="avatar-slot" id="avatarTarget"></div>

        <div class="text-block">
          <div class="greeting-row">
            <span class="txt-thin" id="lblHello">Sistema</span>
            <span class="txt-heavy" id="lblName">Convidado</span>
          </div>
          <div class="brand-dual">DUAL OS</div>
        </div>

        <div class="clock-widget">
          <div class="time-display" id="clockTime">--:--</div>
          <span class="status-led"></span>
        </div>
      </div>

      <div class="card-body" id="cardBody">
        
        <div class="input-wrapper stagger-item">
          <input type="text" class="cyber-input" id="inputUser" placeholder="Autenticação..." autocomplete="off" />
          <i data-lucide="fingerprint" class="input-icon"></i>
        </div>

        <div class="trigger-btn stagger-item" onclick="toggleDetails()">
          <span id="triggerText">EXPANDIR MÓDULOS</span>
          <i data-lucide="chevron-down" id="triggerIcon" style="width:14px"></i>
        </div>

        <div class="hidden-modules stagger-item" id="modulesArea">
          <div class="modules-inner">
            
            <div class="stats-grid">
              <div class="stat-box">
                <span class="stat-lbl">Ping</span>
                <span class="stat-val">12ms</span>
              </div>
              <div class="stat-box">
                <span class="stat-lbl">Core</span>
                <span class="stat-val">V.2.0</span>
              </div>
              <div class="stat-box">
                <span class="stat-lbl">Fluxo</span>
                <span class="stat-val">ALFA</span>
              </div>
            </div>

            <div class="progress-container">
              <div class="bar-meta">
                <span>CICLO DIÁRIO</span>
                <span id="cyclePercent">0%</span>
              </div>
              <div class="bar-track"><div class="bar-fill" id="cycleFill"></div></div>
            </div>

            <div class="html-module-slot">AGUARDANDO INJEÇÃO DE DADOS...</div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <script>
    lucide.createIcons();

    const els = {
      card: document.getElementById('mainCard'),
      header: document.getElementById('cardHeader'),
      avatar: document.getElementById('avatarTarget'),
      input: document.getElementById('inputUser'),
      lblHello: document.getElementById('lblHello'),
      lblName: document.getElementById('lblName'),
      clock: document.getElementById('clockTime'),
      triggerText: document.getElementById('triggerText'),
      triggerIcon: document.getElementById('triggerIcon')
    };

    // Gerador de Avatar SVG
    function injectAvatar(id){
      const svg = `
        <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" preserveAspectRatio="xMidYMid slice">
          <defs>
            <linearGradient id="g${id}" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" style="stop-color:#00f2ff" /><stop offset="100%" style="stop-color:#bd00ff" />
            </linearGradient>
          </defs>
          <rect width="100" height="100" fill="#121216"/>
          <circle cx="50" cy="50" r="25" fill="url(#g${id})" opacity="0.8">
            <animate attributeName="opacity" values="0.8;0.4;0.8" dur="3s" repeatCount="indefinite"/>
          </circle>
          <path d="M50 10 A40 40 0 0 1 90 50" stroke="url(#g${id})" stroke-width="3" fill="none" stroke-linecap="round">
             <animateTransform attributeName="transform" type="rotate" from="0 50 50" to="360 50 50" dur="6s" repeatCount="indefinite"/>
          </path>
        </svg>`;
      els.avatar.innerHTML = svg;
    }
    injectAvatar('X');

    // Inicialização
    window.addEventListener('load', () => {
      setTimeout(()=> els.card.classList.add('intro-done'), 100);
      updateClock();
      
      const savedUser = localStorage.getItem('fusion_user');
      if(savedUser) setIdentity(savedUser);
    });

    // --- CONFIGURAÇÃO DO MORPH ---
    const morphConfig = {
      closed: {
        width: '260px',
        padding: '16px 20px',
        borderRadius: '24px',
        boxShadow: '0 20px 60px rgba(0,0,0,0.5)',
        scale: 1
      },
      open: {
        width: '440px',
        padding: '32px 28px',
        borderRadius: '36px',
        boxShadow: '0 40px 100px rgba(0,0,0,0.8)',
        scale: 1
      }
    };

    // Função Principal de Toggle
    function toggleCard() {
      if(els.card.classList.contains('animating')) return;

      const isOpening = els.card.classList.contains('closed');
      els.card.classList.add('animating');

      const startState = isOpening ? morphConfig.closed : morphConfig.open;
      const endState = isOpening ? morphConfig.open : morphConfig.closed;

      // Se estiver ABRINDO: removemos a classe 'closed' imediatamente para que o DOM exista
      // Mas escondemos o conteúdo via opacidade para fazer a entrada "staggered"
      if(isOpening) {
        els.card.classList.remove('closed');
        els.card.setAttribute('aria-expanded', 'true');
      } else {
        // Se estiver FECHANDO: removemos a classe de visibilidade do conteúdo primeiro
        els.card.classList.remove('content-visible');
        els.card.classList.remove('details-open'); // fecha o accordion se estiver aberto
      }

      // 1. Aplica estilos iniciais inline para garantir suavidade
      Object.assign(els.card.style, {
        width: startState.width,
        padding: startState.padding,
        borderRadius: startState.borderRadius,
        boxShadow: startState.boxShadow
      });

      // 2. Define Keyframes e Easing
      // Usamos easing "backOut" para abrir (overshoot) e "easeOut" normal para fechar
      const easing = isOpening ? 'cubic-bezier(0.34, 1.3, 0.64, 1)' : 'cubic-bezier(0.2, 0, 0.2, 1)';
      const duration = isOpening ? 600 : 450;

      const animation = els.card.animate([
        { ...startState },
        { ...endState }
      ], {
        duration: duration,
        easing: easing,
        fill: 'forwards'
      });

      // 3. Controle durante a animação
      animation.onfinish = () => {
        els.card.classList.remove('animating');
        
        // Limpa estilos inline (deixa o CSS assumir)
        els.card.style = ''; 

        if(isOpening) {
          // Trigger para entrada em cascata (Stagger)
          els.card.classList.add('content-visible');
          els.input.focus();
        } else {
          // Finaliza fechamento
          els.card.classList.add('closed');
          els.card.setAttribute('aria-expanded', 'false');
        }
      };
    }

    // Interação Header
    els.header.addEventListener('click', toggleCard);
    els.header.addEventListener('keydown', (e) => {
      if(e.key === 'Enter' || e.key === ' ') { e.preventDefault(); toggleCard(); }
    });

    // Interação Accordion
    window.toggleDetails = function() {
      els.card.classList.toggle('details-open');
      const isOpen = els.card.classList.contains('details-open');
      els.triggerText.innerText = isOpen ? 'RECOLHER DADOS' : 'EXPANDIR MÓDULOS';
      els.triggerIcon.setAttribute('data-lucide', isOpen ? 'chevron-up' : 'chevron-down');
      lucide.createIcons();
    }

    // Lógica de Usuário
    els.input.addEventListener('input', (e) => {
      const val = e.target.value;
      if(val) { els.lblHello.innerText = 'Olá,'; els.lblName.innerText = val; }
      else { els.lblHello.innerText = 'Sistema'; els.lblName.innerText = 'Convidado'; }
    });
    els.input.addEventListener('blur', (e) => {
      if(e.target.value) localStorage.setItem('fusion_user', e.target.value);
    });
    function setIdentity(name){
      els.input.value = name;
      els.lblHello.innerText = 'Olá,';
      els.lblName.innerText = name;
    }

    // Relógio
    function updateClock(){
      const now = new Date();
      els.clock.innerText = now.toLocaleTimeString('pt-BR', {hour:'2-digit', minute:'2-digit'});
      
      // Barra de progresso do dia
      const start = 0, end = 24;
      const current = now.getHours() + (now.getMinutes()/60);
      const pct = (current / 24) * 100;
      document.getElementById('cycleFill').style.width = pct + '%';
      document.getElementById('cyclePercent').innerText = Math.floor(pct) + '%';
    }
    setInterval(updateClock, 1000);

  </script>
</body>
</html>
